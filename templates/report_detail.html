{% extends "base.html" %}
{% block content %}
<h1 class="mb-3">
  Survey #{{ survey.id }} — Room {{ survey.room_number }} | Batch {{ survey.batch_number }}
</h1>
<p class="text-muted">Filling Date: {{ survey.filling_date }}</p>

<!-- ===== Survey (Static Form) — full detail ===== -->
<div class="card mb-4">
  <div class="card-header"><strong>Identification</strong></div>
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-3"><label class="form-label">Room Number</label><div>{{ survey.room_number }}</div></div>
      <div class="col-md-3"><label class="form-label">Batch Number</label><div>{{ survey.batch_number }}</div></div>
      <div class="col-md-3"><label class="form-label">Filling Date</label><div>{{ survey.filling_date }}</div></div>
    </div>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header"><strong>Compost (Setup)</strong></div>
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-3"><label class="form-label">Compost Amount</label><div>{{ survey.compost_amount }}</div></div>
      <div class="col-md-3"><label class="form-label">Kg</label><div>{{ survey.compost_kg }}</div></div>
      <div class="col-md-3"><label class="form-label">Missing Section</label><div>{{ survey.missing_section }}</div></div>
      <div class="col-md-3"><label class="form-label">Total Room/m²</label><div>{{ survey.total_room_m2 }}</div></div>
      <div class="col-md-3"><label class="form-label">Extra Compost</label><div>{{ survey.extra_compost }}</div></div>
      <div class="col-md-12"><label class="form-label">Compost Remarks</label><div>{{ survey.compost_remarks }}</div></div>
      <div class="col-md-3"><label class="form-label">Compost Arrival (Time)</label><div>{{ survey.compost_arrival }}</div></div>
      <div class="col-md-3"><label class="form-label">Compost Camion Temperature</label><div>{{ survey.compost_camion_temp }}</div></div>
    </div>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header"><strong>Compost Physicals & Scales</strong></div>
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-3"><label class="form-label">Extra Water</label><div>{{ survey.extra_water }}</div></div>
      <div class="col-md-3"><label class="form-label">Compost Height</label><div>{{ survey.compost_height }}</div></div>
      <div class="col-md-3"><label class="form-label">Moist (1–5)</label><div>{{ survey.compost_moist }}</div></div>
      <div class="col-md-3"><label class="form-label">Length (1–5)</label><div>{{ survey.compost_length }}</div></div>
      <div class="col-md-3"><label class="form-label">Texture (1–5)</label><div>{{ survey.compost_texture }}</div></div>
      <div class="col-md-3"><label class="form-label">Spawn (1–5)</label><div>{{ survey.compost_spawn }}</div></div>
    </div>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header"><strong>Casing</strong></div>
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-3"><label class="form-label">Relative Humidity (%)</label><div>{{ survey.relative_humidity }}</div></div>
      <div class="col-md-3"><label class="form-label">Casing Water</label><div>{{ survey.casing_water }}</div></div>
      <div class="col-md-3"><label class="form-label">Casing BBK</label><div>{{ survey.casing_bbk }}</div></div>
      <div class="col-md-3"><label class="form-label">Peat Moss 55%</label><div>{{ survey.casing_peat_55 }}</div></div>
      <div class="col-md-3"><label class="form-label">Peat Moss 110%</label><div>{{ survey.casing_peat_110 }}</div></div>
      <div class="col-md-3"><label class="form-label">Peat Moss 135%</label><div>{{ survey.casing_peat_135 }}</div></div>
      <div class="col-md-3"><label class="form-label">Sugar Beet Lime</label><div>{{ survey.casing_sugar_beet_lime }}</div></div>
      <div class="col-md-3"><label class="form-label">Hydrated Lime</label><div>{{ survey.casing_hydrated_lime }}</div></div>
      <div class="col-md-3"><label class="form-label">Limestone CaCho</label><div>{{ survey.casing_limestone_cacho }}</div></div>
    </div>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header"><strong>Filling & Logistics</strong></div>
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-3"><label class="form-label">Filled (sequence)</label><div>{{ survey.filled }}</div></div>
      <div class="col-md-3"><label class="form-label">Arrived (sequence)</label><div>{{ survey.arrived }}</div></div>
      <div class="col-md-3"><label class="form-label">In Tunnel</label><div>{{ survey.in_tunnel }}</div></div>
      <div class="col-md-3"><label class="form-label">Tunnel Number</label><div>{{ survey.tunnel_number }}</div></div>
    </div>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header"><strong>Spawning & Supplements</strong></div>
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-6"><label class="form-label">Spawn type/Rate</label><div>{{ survey.spawn_type_rate }}</div></div>
      <div class="col-md-6"><label class="form-label">Supplement</label><div>{{ survey.supplement }}</div></div>
      <div class="col-md-3"><label class="form-label">Supplement Kg</label><div>{{ survey.supplement_kg }}</div></div>
      <div class="col-md-3"><label class="form-label">Spawning - N (%)</label><div>{{ survey.spawning_n }}</div></div>
      <div class="col-md-3"><label class="form-label">Spawning - Ash (%)</label><div>{{ survey.spawning_ash }}</div></div>
      <div class="col-md-3"><label class="form-label">Spawning - Wet weight</label><div>{{ survey.spawning_wet_weight }}</div></div>
      <div class="col-md-3"><label class="form-label">Spawning - Cellulose</label><div>{{ survey.spawning_cellulose }}</div></div>
    </div>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header"><strong>Shipping & Casing Measurements</strong></div>
  <div class="card-body">
    <div class="row g-3">
      <div class="col-md-3"><label class="form-label">Shipping - PH</label><div>{{ survey.shipping_ph }}</div></div>
      <div class="col-md-3"><label class="form-label">Shipping - Days</label><div>{{ survey.shipping_days }}</div></div>
      <div class="col-md-3"><label class="form-label">Casing - Thickness</label><div>{{ survey.casing_thickness }}</div></div>
      <div class="col-md-3"><label class="form-label">Casing - Ph</label><div>{{ survey.casing_ph }}</div></div>
      <div class="col-md-3"><label class="form-label">Casing - Humidity</label><div>{{ survey.casing_humidity }}</div></div>
    </div>
  </div>
</div>

<div class="card mb-4">
  <div class="card-header"><strong>Notes</strong></div>
  <div class="card-body">
    <div>{{ survey.notes }}</div>
  </div>
</div>

<!-- ===== Daily Stats — full table with ALL fields from daily_new.html ===== -->
<h3 class="mt-4 mb-2">Daily Stats</h3>
{% if survey.daily_stats %}
<div class="table-responsive">
  <table class="table table-sm table-bordered align-middle">
    <thead class="table-light">
    <tr>
      <th>Date</th>
      <th>Comp Ctrl</th>
      <th>Comp Temp</th>
      <th>Comp Max</th>
      <th>Air Ctrl</th>
      <th>Air Meas</th>
      <th>CO₂</th>
      <th>CO₂ Meas</th>
      <th>RH Meas</th>
      <th>Max</th>
      <th>Ab.</th>
      <th>Fresh Air</th>
      <th>Fresh Air Meas</th>
      <th>Fan</th>
      <th>Fan Meas</th>
      <th>Heat</th>
      <th>Temp</th>
      <th>Cool Temp</th>
      <th>H₂O</th>
      <th>Ref Temp</th>
      <th>Remarks</th>
      <th style="min-width:140px">Actions</th>
    </tr>
    </thead>
    <tbody>
    {% for stat in survey.daily_stats %}
    <tr>
      <td>{{ stat.stat_date }}</td>
      <td>{{ stat.comp_ctrl }}</td>
      <td>{{ stat.comp_temp }}</td>
      <td>{{ stat.comp_max }}</td>
      <td>{{ stat.air_ctrl }}</td>
      <td>{{ stat.air_meas }}</td>
      <td>{{ stat.co2 }}</td>
      <td>{{ stat.co2_meas }}</td>
      <td>{{ stat.rh_meas }}</td>
      <td>{{ stat.max_val }}</td>
      <td>{{ stat.ab_val }}</td>
      <td>{{ stat.fresh_air }}</td>
      <td>{{ stat.fresh_air_meas }}</td>
      <td>{{ stat.fan }}</td>
      <td>{{ stat.fan_meas }}</td>
      <td>{{ stat.heat }}</td>
      <td>{{ stat.temp }}</td>
      <td>{{ stat.cool_temp }}</td>
      <td>{{ stat.h2o }}</td>
      <td>{{ stat.ref_temp }}</td>
      <td>{{ stat.remarks }}</td>
      <td>
        <a href="{{ url_for('edit_daily', stat_id=stat.id) }}" class="btn btn-sm btn-outline-secondary">Edit</a>
        <form method="post" action="{{ url_for('delete_daily', stat_id=stat.id) }}" class="d-inline"
              onsubmit="return confirm('Delete this daily stat?')">
          <button class="btn btn-sm btn-outline-danger">Delete</button>
        </form>
      </td>
    </tr>
    {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<p class="text-muted">No daily stats yet.</p>
{% endif %}

<div class="mt-3">
  <a href="{{ url_for('report_redirect') }}" class="btn btn-outline-secondary">Back to Reports</a>
</div>
{% endblock %}
